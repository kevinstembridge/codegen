// This source was generated by the Mahana Mongogen generator
// Renderer class: class com.mahanaroad.mongogen.generator.entities.EntityUpdaterRenderer
// Rendered at: 2016-09-30T22:30:59.723Z

package com.mahanaroad.mongogen.sample.simple;

import java.time.Instant;
import java.time.LocalDate;
import java.time.Period;
import java.util.HashMap;
import java.util.Map;
import java.util.Objects;
import java.util.Optional;
import java.util.OptionalInt;
import org.bson.Document;
import org.bson.conversions.Bson;
import org.bson.types.ObjectId;


public class SimpleEntityUpdater {


    private final ObjectId id;
    private final Map<String, Object> fields = new HashMap<>();



    private SimpleEntityUpdater(final ObjectId id, final Map<String, Object> fields) {

        this.id = Objects.requireNonNull(id, "id");
        this.fields.putAll(fields);

    }


    public ObjectId getId() {

        return this.id;

    }


    public Bson toBson(final SimpleEntityFieldConverter fieldConverter) {

        final Document setFieldsDocument = new Document();
        final Document unsetFieldsDocument = new Document();

        this.fields.forEach((collectionFieldName, fieldValue) -> {

            if (fieldValue instanceof Optional) {

                final Optional fieldValueOptional = (Optional) fieldValue;

                if (fieldValueOptional.isPresent()) {
                    setFieldsDocument.put(collectionFieldName, fieldConverter.convert(collectionFieldName, fieldValueOptional.get()));
                } else {
                    unsetFieldsDocument.put(collectionFieldName, "");
                }

            } else {

                setFieldsDocument.put(collectionFieldName, fieldConverter.convert(collectionFieldName, fieldValue));
            }

        });

        final Document document = new Document();

        if (setFieldsDocument.isEmpty() == false) {
            document.put("$set", setFieldsDocument);
        }

        if (unsetFieldsDocument.isEmpty() == false) {
            document.put("$unset", unsetFieldsDocument);
        }

        return document;

    }


    public static Builder forId(final ObjectId id) {

        return new Builder(id);

    }


    public static class Builder {


        private final ObjectId id;
        private final Map<String, Object> fields = new HashMap<>();

        private Builder(final ObjectId id) {

            this.id = Objects.requireNonNull(id, "id");

        }


        public SimpleEntityUpdater build() {

            return new SimpleEntityUpdater(this.id, this.fields);

        }


        public Builder setSomeModifiableInstant(final Instant someModifiableInstant) {

            this.fields.put("smi", someModifiableInstant);
            return this;

        }


        public Builder setSomeModifiableInt(final int someModifiableInt) {

            this.fields.put("smint", someModifiableInt);
            return this;

        }


        public Builder setSomeModifiableLocalDate(final LocalDate someModifiableLocalDate) {

            this.fields.put("smld", someModifiableLocalDate);
            return this;

        }


        public Builder setSomeModifiablePeriod(final Period someModifiablePeriod) {

            this.fields.put("smp", someModifiablePeriod);
            return this;

        }


        public Builder setSomeModifiableString(final String someModifiableString) {

            this.fields.put("sms", someModifiableString);
            return this;

        }


        public Builder setSomeOptionalInt(final OptionalInt someOptionalInt) {

            this.fields.put("soint", someOptionalInt);
            return this;

        }


        public Builder setSomeOptionalModifiableInstant(final Optional<Instant> someOptionalModifiableInstant) {

            this.fields.put("somi", someOptionalModifiableInstant);
            return this;

        }


    }


}
