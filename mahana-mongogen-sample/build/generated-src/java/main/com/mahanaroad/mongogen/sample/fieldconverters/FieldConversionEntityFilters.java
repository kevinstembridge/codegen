// This source was generated by the Mahana Mongogen generator
// Renderer class: class com.mahanaroad.mongogen.generator.entities.EntityFiltersRenderer
// Rendered at: 2016-09-30T22:30:59.396Z

package com.mahanaroad.mongogen.sample.fieldconverters;

import com.mahanaroad.mongogen.BlankStringException;
import com.mongodb.client.model.Filters;;
import java.time.Instant;
import java.util.Arrays;
import java.util.List;
import java.util.Optional;
import java.util.function.Function;
import java.util.function.Supplier;
import java.util.stream.Collectors;
import org.bson.conversions.Bson;
import org.bson.types.ObjectId;


public class FieldConversionEntityFilters {


    public static FieldConversionEntityFilter and(final FieldConversionEntityFilter... filters) {

        return new IterableFunctionFilter(Arrays.asList(filters), Filters::and);

    }


    public static FieldConversionEntityFilter or(final FieldConversionEntityFilter... filters) {

        return new IterableFunctionFilter(Arrays.asList(filters), Filters::or);

    }


    public static FieldConversionEntityFilter nor(final FieldConversionEntityFilter... filters) {

        return new IterableFunctionFilter(Arrays.asList(filters), Filters::nor);

    }


    public static FieldFilter<Instant> createdTimestampUtc() {

        return new FieldFilter<>("c-ts");

    }


    public static FieldFilter<ObjectId> id() {

        return new FieldFilter<>("_id");

    }


    public static FieldFilter<Optional<Instant>> lastModifiedTimestampUtc() {

        return new FieldFilter<>("lm-ts");

    }


    public static FieldFilter<String> someStringWithFieldLevelReader() {

        return new FieldFilter<>("fl");

    }


    public static FieldFilter<String> someStringWithFieldTypeLevelReader() {

        return new FieldFilter<>("ft");

    }



    private FieldConversionEntityFilters() {

    }


    public static class FieldFilter<T> {


        private final String collectionFieldName;


        private FieldFilter(final String collectionFieldName) {

            this.collectionFieldName = BlankStringException.throwIfBlank(collectionFieldName, "collectionFieldName");

        }


        public FieldConversionEntityFilter eq(final T value) {

            return new SimpleFunctionFilter<>(this.collectionFieldName, value, convertedValue -> Filters.eq(this.collectionFieldName, convertedValue));

        }


        public FieldConversionEntityFilter gt(final T value) {

            return new SimpleFunctionFilter<>(this.collectionFieldName, value, convertedValue -> Filters.gt(this.collectionFieldName, convertedValue));

        }


        public FieldConversionEntityFilter gte(final T value) {

            return new SimpleFunctionFilter<>(this.collectionFieldName, value, convertedValue -> Filters.gte(this.collectionFieldName, convertedValue));

        }


        public FieldConversionEntityFilter lt(final T value) {

            return new SimpleFunctionFilter<>(this.collectionFieldName, value, convertedValue -> Filters.lt(this.collectionFieldName, convertedValue));

        }


        public FieldConversionEntityFilter lte(final T value) {

            return new SimpleFunctionFilter<>(this.collectionFieldName, value, convertedValue -> Filters.lte(this.collectionFieldName, convertedValue));

        }


        public FieldConversionEntityFilter ne(final T value) {

            return new SimpleFunctionFilter<>(this.collectionFieldName, value, convertedValue -> Filters.ne(this.collectionFieldName, convertedValue));

        }


        public FieldConversionEntityFilter exists() {

            return new SimpleSupplierFilter(() -> Filters.exists(this.collectionFieldName));

        }


    }


    private static class SimpleSupplierFilter implements FieldConversionEntityFilter {

        private final Supplier<Bson> supplier;


        private SimpleSupplierFilter(final Supplier<Bson> supplier) {

            this.supplier = supplier;

        }


        @Override
        public Bson toBson(final FieldConversionEntityFieldConverter fieldConverter) {

            return this.supplier.get();

        }


    }


    private static class SimpleFunctionFilter<VALUE> implements FieldConversionEntityFilter {

        private final String fieldName;
        private final VALUE value;
        private final Function<Object, Bson> bsonFunction;


        private SimpleFunctionFilter(final String fieldName, final VALUE value, final Function<Object, Bson> bsonFunction) {

            this.fieldName = BlankStringException.throwIfBlank(fieldName, "fieldName");
            this.value = value;
            this.bsonFunction = bsonFunction;

        }


        @Override
        public Bson toBson(final FieldConversionEntityFieldConverter fieldConverter) {

            final Object convertedValue = fieldConverter.convert(this.fieldName, this.value);
            return this.bsonFunction.apply(convertedValue);

        }


    }


    private static class IterableFunctionFilter implements FieldConversionEntityFilter {

        private final Function<List<Bson>, Bson> bsonFunction;
        private final List<FieldConversionEntityFilter> filters;


        private IterableFunctionFilter(final List<FieldConversionEntityFilter> filters, final Function<List<Bson>, Bson> bsonFunction) {

            this.filters = filters;
            this.bsonFunction = bsonFunction;

        }


        @Override
        public Bson toBson(final FieldConversionEntityFieldConverter fieldConverter) {

            final List<Bson> bsons = this.filters.stream().map(filter -> filter.toBson(fieldConverter)).collect(Collectors.toList());
            return this.bsonFunction.apply(bsons);

        }


    }


}
